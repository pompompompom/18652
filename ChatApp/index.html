<!doctype html>
<html>
<head>
  <title>Socket.IO chat</title>
  <style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font: 16px Helvetica, Arial; }
  form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100% !important; max-width:100% !important; }
  #messages { list-style-type: none; margin: 0; padding: 0; }
  #messages li {font: 16px Helvetica, Arial;  padding: 5px 10px; }
  #messages li:nth-child(odd) { background: #eee; }
  </style>
  <link href="http://www.testrun.info/aisha-gold/css/maincss.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <ul id="messages"></ul>
  <form id="form_messages" class ="basic-grey"  action="">
    <input id="m" type="text" style='width:90%;' autocomplete="off" />    <input type="submit" class="button" value="Send" />
  </form>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script>

  //Handle querystring splicing
  function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
    results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }

  //Name of the person
  var name = getParameterByName('name');

  var socket = io();

  socket.emit('c_msg_adduser', name);



  $('#form_messages').submit(function(){
    var dt = new Date();
    var time = dt.getFullYear() + '.' + dt.getMonth()+1 + '.' + dt.getDate() + '@' + dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();
    socket.emit('c_msg_pkt', {'name': name, 'time': time, 'content': $('#m').val() });
    $('#m').val('');
    return false;
  });

  socket.on('c_msg_pkt', function(msg){
    $('#messages').append($('<li>').text(msg['name']+' ('+msg['time']+'): ' + msg['content']));

  });

  socket.on('c_msg_newuser', function(msg){
    $('#messages').append($('<li>').text(msg + ' Joined!'));
  });

  socket.on('c_msg_deleteuser', function(msg){
    $('#messages').append($('<li>').text(msg + ' Left!'));
  });




</script>
</body>
</html>
